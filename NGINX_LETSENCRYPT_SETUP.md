# Nginx & HTTPS Setup Guide (Let's Encrypt / Certbot)

This guide explains how to configure your Google Cloud VM to serve your application over HTTPS using Let's Encrypt and Certbot.

## Prerequisites
*   **Cloudflare:** Ensure your DNS A record for `admin.tellevoapp.com` is proxied (Orange Cloud) OR DNS Only (Grey Cloud).
    *   *Recommendation:* For Let's Encrypt HTTP-01 challenge to work easily behind Cloudflare, ensure Cloudflare SSL/TLS is set to **Full** or **Flexible** initially, but **Full (Strict)** is best once everything is working.
    *   **Important:** If using Cloudflare Proxy, ensure "Always Use HTTPS" is temporarily **OFF** in Cloudflare to avoid redirect loops during setup, or just trust Certbot to handle it.
*   SSH access to your Google Cloud VM.
*   `sudo` privileges.

## Step 1: Install Nginx and Certbot
SSH into your VM and run:
```bash
sudo apt update
sudo apt install nginx python3-certbot-nginx -y
```

## Step 2: Deploy Frontend Files
1.  Create the directory:
    ```bash
    sudo mkdir -p /var/www/admin-frontend
    ```
2.  Upload your local `dist/` folder (generated by `npm run build`) to `/var/www/admin-frontend` on the VM.

## Step 3: Configure Nginx (Base Config)
1.  Copy the provided `nginx-letsencrypt.conf` to `/etc/nginx/sites-available/admin`:
    ```bash
    sudo nano /etc/nginx/sites-available/admin
    ```
    *   Paste the content of `nginx-letsencrypt.conf`.
2.  Enable the site:
    ```bash
    sudo ln -s /etc/nginx/sites-available/admin /etc/nginx/sites-enabled/
    sudo rm /etc/nginx/sites-enabled/default  # Remove default site
    ```
3.  Test configuration:
    ```bash
    sudo nginx -t
    ```
4.  Reload Nginx:
    ```bash
    sudo systemctl reload nginx
    ```

## Step 4: Run Certbot
Run the following command to obtain the certificate and automatically configure Nginx:
```bash
sudo certbot --nginx -d admin.tellevoapp.com
```
1.  Enter your email when prompted.
2.  Agree to terms (A).
3.  **Redirect:** Choose **2** (Redirect) to automatically redirect HTTP to HTTPS.

## Step 5: Verify Auto-Renewal
Certbot sets up a timer automatically. Verify it works:
```bash
sudo certbot renew --dry-run
```

## Verification
Visit `https://admin.tellevoapp.com`.
*   It should load your Vue app securely.
*   API calls should work.
*   The certificate issuer should be "Let's Encrypt".
